import{createRequest as e}from"@urql/core";export*from"@urql/core";import*as r from"react";import{toPromise as t,take as n,filter as u,onPush as a,subscribe as o,takeWhile as i,onEnd as c}from"wonka";var s=r.createContext({}),f=s.Provider,l=s.Consumer;s.displayName="UrqlContext";var v=()=>r.useContext(s),d={fetching:!1,stale:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0},x=(e,r)=>e===r||!(!e||!r||e.key!==r.key),y=(e,r)=>{var t={...e,...r,data:void 0!==r.data||r.error?r.data:e.data,fetching:!!r.fetching,stale:!!r.stale};return((e,r)=>{for(var t in e)if(!(t in r))return!0;for(var n in r)if("operation"===n?!x(e[n],r[n]):e[n]!==r[n])return!0;return!1})(e,t)?t:e},p=(e,r)=>{for(var t=0,n=r.length;t<n;t++)if(e[t]!==r[t])return!0;return!1};function h(e,r){e(r)}function g(o){var i=r.useRef(!0),c=v(),[s,f]=r.useState(d),l=r.useCallback(((r,s)=>(h(f,{...d,fetching:!0}),t(n(1)(u((e=>!e.hasNext))(a((e=>{i.current&&h(f,{fetching:!1,stale:e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation})}))(c.executeMutation(e(o,r),s||{}))))))),[c,o,f]);return r.useEffect((()=>(i.current=!0,()=>{i.current=!1})),[]),[s,l]}function k(t,n){var u=r.useRef(void 0);return r.useMemo((()=>{var r=e(t,n);return void 0!==u.current&&u.current.key===r.key?u.current:(u.current=r,r)}),[t,n])}var b=e=>{if(!e._react){var r=new Set,t=new Map;e.operations$&&o((e=>{"teardown"===e.kind&&r.has(e.key)&&(r.delete(e.key),t.delete(e.key))}))(e.operations$),e._react={get:e=>t.get(e),set(e,n){r.delete(e),t.set(e,n)},dispose(e){r.add(e)}}}return e._react},m=(e,r)=>e.suspense&&(!r||!1!==r.suspense);function q(e){var t=v(),n=b(t),u=m(t,e.context),s=k(e.query,e.variables),f=r.useMemo((()=>{if(e.pause)return null;var r=t.executeQuery(s,{requestPolicy:e.requestPolicy,...e.context});return u?a((e=>{n.set(s.key,e)}))(r):r}),[n,t,s,u,e.pause,e.requestPolicy,e.context]),l=r.useCallback(((e,r)=>{if(!e)return{fetching:!1};var t=n.get(s.key);if(t){if(r&&null!=t&&"then"in t)throw t}else{var u,a=o((e=>{t=e,u&&u(t)}))(i((()=>r&&!u||!t))(e));if(null==t&&r){var c=new Promise((e=>{u=e}));throw n.set(s.key,c),c}a.unsubscribe()}return t||{fetching:!0}}),[n,s]),x=[t,s,e.requestPolicy,e.context,e.pause],[g,q]=r.useState((()=>[f,y(d,l(f,u)),x])),P=g[1];f!==g[0]&&p(g[2],x)&&q([f,P=y(g[1],l(f,u)),x]),r.useEffect((()=>{var e=g[0],r=g[2][1],t=!1,u=e=>{t=!0,h(q,(r=>{var t=y(r[1],e);return r[1]!==t?[r[0],t,r[2]]:r}))};if(e){var a=o(u)(c((()=>{u({fetching:!1})}))(e));return t||u({fetching:!0}),()=>{n.dispose(r.key),a.unsubscribe()}}u({fetching:!1})}),[n,g[0],g[2][1]]);var C=r.useCallback((r=>{var o={requestPolicy:e.requestPolicy,...e.context,...r};h(q,(e=>[u?a((e=>{n.set(s.key,e)}))(t.executeQuery(s,o)):t.executeQuery(s,o),e[1],x]))}),[t,n,s,u,l,e.requestPolicy,e.context]);return[P,C]}function P(e,t){var n=v(),u=k(e.query,e.variables),a=r.useRef(t);a.current=t;var i=r.useMemo((()=>e.pause?null:n.executeSubscription(u,e.context)),[n,u,e.pause,e.context]),s=[n,u,e.context,e.pause],[f,l]=r.useState((()=>[i,{...d,fetching:!!i},s])),x=f[1];i!==f[0]&&p(f[2],s)&&l([i,x=y(f[1],{fetching:!!i}),s]),r.useEffect((()=>{var e=e=>{h(l,(r=>{var t=y(r[1],e);return r[1]===t?r:(a.current&&r[1].data!==t.data&&(t.data=a.current(r[1].data,t.data)),[r[0],t,r[2]])}))};if(f[0])return o(e)(c((()=>{e({fetching:!!i})}))(f[0])).unsubscribe;e({fetching:!1})}),[f[0]]);var g=r.useCallback((r=>{var t=n.executeSubscription(u,{...e.context,...r});h(l,(e=>[t,e[1],s]))}),[n,e.context,u]);return[x,g]}function C(e){var r=g(e.query);return e.children({...r[0],executeMutation:r[1]})}function w(e){var r=q(e);return e.children({...r[0],executeQuery:r[1]})}function S(e){var r=P(e,e.handler);return e.children({...r[0],executeSubscription:r[1]})}export{l as Consumer,s as Context,C as Mutation,f as Provider,w as Query,S as Subscription,v as useClient,g as useMutation,q as useQuery,P as useSubscription};
//# sourceMappingURL=urql.min.es.js.map
