Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@urql/core"),t=require("react"),r=require("wonka"),n=t.createContext({}),u=n.Provider,a=n.Consumer;n.displayName="UrqlContext";var s=()=>t.useContext(n),o={fetching:!1,stale:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0},i=(e,t)=>e===t||!(!e||!t||e.key!==t.key),c=(e,t)=>{var r={...e,...t,data:void 0!==t.data||t.error?t.data:e.data,fetching:!!t.fetching,stale:!!t.stale};return((e,t)=>{for(var r in e)if(!(r in t))return!0;for(var n in t)if("operation"===n?!i(e[n],t[n]):e[n]!==t[n])return!0;return!1})(e,r)?r:e},f=(e,t)=>{for(var r=0,n=t.length;r<n;r++)if(e[r]!==t[r])return!0;return!1};function l(e,t){e(t)}function d(n){var u=t.useRef(!0),a=s(),[i,c]=t.useState(o),f=t.useCallback(((t,s)=>(l(c,{...o,fetching:!0}),r.toPromise(r.take(1)(r.filter((e=>!e.hasNext))(r.onPush((e=>{u.current&&l(c,{fetching:!1,stale:e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation})}))(a.executeMutation(e.createRequest(n,t),s||{}))))))),[a,n,c]);return t.useEffect((()=>(u.current=!0,()=>{u.current=!1})),[]),[i,f]}function v(r,n){var u=t.useRef(void 0);return t.useMemo((()=>{var t=e.createRequest(r,n);return void 0!==u.current&&u.current.key===t.key?u.current:(u.current=t,t)}),[r,n])}function x(e){var n=s(),u=(e=>{if(!e._react){var t=new Set,n=new Map;e.operations$&&r.subscribe((e=>{"teardown"===e.kind&&t.has(e.key)&&(t.delete(e.key),n.delete(e.key))}))(e.operations$),e._react={get:e=>n.get(e),set(e,r){t.delete(e),n.set(e,r)},dispose(e){t.add(e)}}}return e._react})(n),a=((e,t)=>e.suspense&&(!t||!1!==t.suspense))(n,e.context),i=v(e.query,e.variables),d=t.useMemo((()=>{if(e.pause)return null;var t=n.executeQuery(i,{requestPolicy:e.requestPolicy,...e.context});return a?r.onPush((e=>{u.set(i.key,e)}))(t):t}),[u,n,i,a,e.pause,e.requestPolicy,e.context]),x=t.useCallback(((e,t)=>{if(!e)return{fetching:!1};var n=u.get(i.key);if(n){if(t&&null!=n&&"then"in n)throw n}else{var a,s=r.subscribe((e=>{n=e,a&&a(n)}))(r.takeWhile((()=>t&&!a||!n))(e));if(null==n&&t){var o=new Promise((e=>{a=e}));throw u.set(i.key,o),o}s.unsubscribe()}return n||{fetching:!0}}),[u,i]),p=[n,i,e.requestPolicy,e.context,e.pause],[y,h]=t.useState((()=>[d,c(o,x(d,a)),p])),b=y[1];d!==y[0]&&f(y[2],p)&&h([d,b=c(y[1],x(d,a)),p]),t.useEffect((()=>{var e=y[0],t=y[2][1],n=!1,a=e=>{n=!0,l(h,(t=>{var r=c(t[1],e);return t[1]!==r?[t[0],r,t[2]]:t}))};if(e){var s=r.subscribe(a)(r.onEnd((()=>{a({fetching:!1})}))(e));return n||a({fetching:!0}),()=>{u.dispose(t.key),s.unsubscribe()}}a({fetching:!1})}),[u,y[0],y[2][1]]);var k=t.useCallback((t=>{var s={requestPolicy:e.requestPolicy,...e.context,...t};l(h,(e=>[a?r.onPush((e=>{u.set(i.key,e)}))(n.executeQuery(i,s)):n.executeQuery(i,s),e[1],p]))}),[n,u,i,a,x,e.requestPolicy,e.context]);return[b,k]}function p(e,n){var u=s(),a=v(e.query,e.variables),i=t.useRef(n);i.current=n;var d=t.useMemo((()=>e.pause?null:u.executeSubscription(a,e.context)),[u,a,e.pause,e.context]),x=[u,a,e.context,e.pause],[p,y]=t.useState((()=>[d,{...o,fetching:!!d},x])),h=p[1];d!==p[0]&&f(p[2],x)&&y([d,h=c(p[1],{fetching:!!d}),x]),t.useEffect((()=>{var e=e=>{l(y,(t=>{var r=c(t[1],e);return t[1]===r?t:(i.current&&t[1].data!==r.data&&(r.data=i.current(t[1].data,r.data)),[t[0],r,t[2]])}))};if(p[0])return r.subscribe(e)(r.onEnd((()=>{e({fetching:!!d})}))(p[0])).unsubscribe;e({fetching:!1})}),[p[0]]);var b=t.useCallback((t=>{var r=u.executeSubscription(a,{...e.context,...t});l(y,(e=>[r,e[1],x]))}),[u,e.context,a]);return[h,b]}exports.Consumer=a,exports.Context=n,exports.Mutation=function(e){var t=d(e.query);return e.children({...t[0],executeMutation:t[1]})},exports.Provider=u,exports.Query=function(e){var t=x(e);return e.children({...t[0],executeQuery:t[1]})},exports.Subscription=function(e){var t=p(e,e.handler);return e.children({...t[0],executeSubscription:t[1]})},exports.useClient=s,exports.useMutation=d,exports.useQuery=x,exports.useSubscription=p,Object.keys(e).forEach((function(t){"default"===t||exports.hasOwnProperty(t)||Object.defineProperty(exports,t,{enumerable:!0,get:function(){return e[t]}})}));
//# sourceMappingURL=urql.min.js.map
